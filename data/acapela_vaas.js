// Generated by CoffeeScript 1.10.0
var API_URL, application, options, password, text, textToSpeech, username;

application = 'EVAL_<NUMBER>';

username = 'EVAL_VAAS';

password = '<PASSWORD>';

API_URL = 'http://vaas.acapela-group.com/Services/Synthesizer';

options = {
  'prot_vers': '2',
  'cl_env': 'PHP_APACHE_2.2.3_LINUX_SUSE',
  'cl_vers': '1-30',
  'cl_login': username,
  'cl_app': application,
  'cl_pwd': password,
  'req_type': '',
  'req_snd_id': '',
  'req_voice': 'graham22k',
  'req_text': '',
  'req_vol': '',
  'req_spd': '',
  'req_vct': '',
  'req_eq1': '',
  'req_eq2': '',
  'req_eq3': '',
  'req_eq4': '',
  'req_snd_type': '',
  'req_snd_ext': '',
  'req_snd_kbps': '',
  'req_alt_snd_type': '',
  'req_alt_snd_ext': '',
  'req_alt_snd_kbps': '',
  'req_wp': '',
  'req_bp': '',
  'req_mp': '',
  'req_comment': 'That\'s what I call a comment!',
  'req_start_time': '',
  'req_timeout': '',
  'req_asw_type': '',
  'req_asw_as_alt_snd': '',
  'req_err_as_id3': '',
  'req_echo': 'ON'
};

textToSpeech = function(text) {
  var results;
  results = {};
  return new Promise(function(fulfill, reject) {
    console.log("Converting " + text + " into speech...");
    options.req_text = text;
    return require('superagent').post(API_URL).type('form').send(options).end(function(err, res) {
      var result;
      if (err) {
        return reject(err);
      } else {
        result = res.text.split("&");
        results = result.reduce(function(prev, curr) {
          var attr;
          attr = curr.split("=");
          prev[attr[0]] = attr[1];
          return prev;
        }, {});
        if (results['res'] === 'NOK') {
          return reject({
            'err_code': results['err_code'],
            'err_msg': decodeURIComponent(results['err_msg'])
          });
        } else {
          return fulfill({
            'snd_url': results['snd_url']
          });
        }
      }
    });
  });
};

text = process.argv.splice(2)[0];

if (text !== void 0) {
  textToSpeech(text).then(function(res) {
    return console.log(res);
  })["catch"](function(e) {
    return console.log(e);
  });
}


/* USAGE:

textToSpeech('Testing some text')
.then( (res)-> console.log res )
.catch( (e)-> console.log e )
 */
